# MongoDB Sharding

`MongoDB Sharding`μ— λ€ν• λΉ λ¥Έ μ΄ν•΄λ¥Ό μ„ν•΄ [κ³µμ‹ λ¬Έμ„](https://www.mongodb.com/docs/manual/sharding/)λ¥Ό κ°„λµν•κ² μ •λ¦¬ν•κ³ μ ν•©λ‹λ‹¤.

## Sharding?

> λ°μ΄ν„°λ¥Ό μ—¬λ¬ λ¨Έμ‹ μ— λ¶„μ‚°ν•λ” λ°©λ²•

MongoDBλ” μƒ¤λ”©μ„ ν†µν• μν‰μ  ν™•μ¥μ„ μ§€μ›
- **μν‰μ  ν™•μ¥**: μ‹μ¤ν… λ°μ΄ν„° μ„ΈνΈμ™€ λ΅λ“λ¥Ό μ—¬λ¬ μ„λ²„λ΅ λ‚λ„κ³  ν•„μ”μ— λ”°λΌ μ„λ²„λ¥Ό μ¶”κ°€ν•μ—¬ μ©λ‰μ„ λλ¦¬λ” κ²ƒ

<br/>

## Sharded Cluster

> μ»¬λ ‰μ… μμ¤€μ—μ„ λ°μ΄ν„°λ¥Ό μƒ¤λ”©ν•μ—¬ ν΄λ¬μ¤ν„°μ μƒ¤λ“ μ „μ²΄μ— μ»¬λ ‰μ… λ°μ΄ν„°λ¥Ό λ¶„μ‚°

κµ¬μ„± μ»΄ν¬λ„νΈ
- `shard`: κ° μƒ¤λ“μ—λ” μƒ¤λ“ λ°μ΄ν„°μ ν•μ„ μ§‘ν•©μ΄ ν¬ν•¨.
  - κ° μƒ¤λ“λ” λ³µμ λ³Έ μ„ΈνΈλ΅ λ°°ν¬λμ–΄μ•Ό ν•¨
- `Routing with mongos`: mongosλ” ν΄λΌμ΄μ–ΈνΈ μ• ν”λ¦¬μΌ€μ΄μ…κ³Ό μƒ¤λ”©λ ν΄λ¬μ¤ν„° κ°„μ μΈν„°νμ΄μ¤λ¥Ό μ κ³µν•λ” μΏΌλ¦¬ λΌμ°ν„° μ—­ν• 
- `config servers`: config μ„λ²„λ” ν΄λ¬μ¤ν„°μ— λ€ν• λ©”νƒ€λ°μ΄ν„°μ™€ κµ¬μ„± μ„¤μ •μ„ μ €μ¥
  - config μ„λ²„λ” λ³µμ λ³Έ μ„ΈνΈ(CSRS)λ΅ λ°°ν¬λμ–΄μ•Ό ν•¨

<br/>

## Shard Keys

> MongoDBλ” μƒ¤λ“ ν‚¤λ¥Ό μ‚¬μ©ν•μ—¬ μƒ¤λ“ μ „λ°μ—μ„ μ»¬λ ‰μ… λ¬Έμ„λ¥Ό λ¶„μ‚°
> 
> μƒ¤λ“ ν‚¤λ” λ¬Έμ„μ ν•„λ“ ν•λ‚ λλ” μ—¬λ¬ ν•„λ“λ΅ κµ¬μ„±

μƒ¤λ”©λ μ»¬λ ‰μ…μ λ¬Έμ„μ—λ” μƒ¤λ“ ν‚¤ ν•„λ“κ°€ λ„λ½λ  μ μμµλ‹λ‹¤. 
- λ„λ½λ μƒ¤λ“ ν‚¤ ν•„λ“λ” λ¬Έμ„λ¥Ό μ—¬λ¬ μƒ¤λ“μ— λ¶„μ‚°ν•  λ• null κ°’μ΄ μλ” κ²ƒμΌλ΅ μ²λ¦¬
- nullμ΄ μ•„λ‹ κ°’μΌλ΅ μ±„μ›μ§€λ„λ΅ μ„¤μ •λ„ κ°€λ¥

μƒ¤λ“ λ°μ΄ν„°λ¥Ό μ²­ν¬λ΅ λ¶„ν• ν•λ”λ°, κ° μ²­ν¬μ—λ” μƒ¤λ“ ν‚¤μ— λ”°λΌ ν¬κ΄„μ μΈ ν•μ„ λ²”μ„μ™€ λ°°νƒ€μ μΈ μƒμ„ λ²”μ„κ°€ μμµλ‹λ‹¤.

<br/>

**Shard Key Index**
- μ±„μ›μ§„ μ»¬λ ‰μ…μ„ μƒ¤λ”©ν•λ ¤λ©΄ μ»¬λ ‰μ…μ— μƒ¤λ“ ν‚¤λ΅ μ‹μ‘ν•λ” μΈλ±μ¤κ°€ μμ–΄μ•Ό ν•©λ‹λ‹¤. 
- λΉ μ»¬λ ‰μ…μ„ μƒ¤λ”©ν•  λ•, μ»¬λ ‰μ…μ— μ§€μ •λ μƒ¤λ“ ν‚¤μ— λ€ν• μ μ ν• μΈλ±μ¤κ°€ μ•„μ§ μ—†λ” κ²½μ° MongoDBλ” μ§€μ› μΈλ±μ¤λ¥Ό μƒμ„±ν™λ‹λ‹¤.

**Shard Key Strategy**
- μƒ¤λ“ ν‚¤ μ„ νƒμ€ μƒ¤λ”©λ ν΄λ¬μ¤ν„°μ μ„±λ¥, ν¨μ¨μ„± λ° ν™•μ¥μ„±μ— μν–¥μ„ μ¤„ μ μμµλ‹λ‹¤.

π‘‰π» λ‚μ¤‘μ— μ»¬λ ‰μ…μ„ λ‹¤μ‹ μƒ¤λ”©ν•  μλ” μμ§€λ§, ν™•μ¥μ„± λ° μ„±λ¥ κ΄€λ ¨ λ¬Έμ λ¥Ό ν”Όν•λ ¤λ©΄ μƒ¤λ“ ν‚¤ μ„ νƒμ„ μ‹ μ¤‘ν•κ² κ³ λ ¤ν•λ” κ²ƒμ΄ μ¤‘μ”ν•©λ‹λ‹¤.

<br/>

## Advantages of Sharding

**μ½κΈ°/μ“°κΈ°**
- μƒ¤λ”©λ ν΄λ¬μ¤ν„°μ μƒ¤λ“ μ „λ°μ— μ½κΈ° λ° μ“°κΈ° μ›ν¬λ΅λ“λ¥Ό λ¶„μ‚°μ‹μΌ κ° μƒ¤λ“κ°€ ν΄λ¬μ¤ν„° μ‘μ—…μ ν•μ„ μ§‘ν•©μ„ μ²λ¦¬ν•  μ μλ„λ΅ ν•©λ‹λ‹¤.
- μ½κΈ° λ° μ“°κΈ° μ›ν¬λ΅λ“λ” λ” λ§μ€ μƒ¤λ“λ¥Ό μ¶”κ°€ν•μ—¬ ν΄λ¬μ¤ν„° μ „λ°μ—μ„ μν‰μΌλ΅ ν™•μ¥ κ°€λ¥ν•©λ‹λ‹¤.

**μ €μ¥ μ©λ‰**
- μƒ¤λ”©μ€ ν΄λ¬μ¤ν„°μ μƒ¤λ“ μ „λ°μ— λ°μ΄ν„°λ¥Ό λ¶„μ‚°μ‹μΌ κ° μƒ¤λ“κ°€ μ „μ²΄ ν΄λ¬μ¤ν„° λ°μ΄ν„°μ ν•μ„ μ§‘ν•©μ„ ν¬ν•¨ν•λ„λ΅ ν•©λ‹λ‹¤. 
- λ°μ΄ν„°κ°€ μ¦κ°€ν•¨μ— λ”°λΌ μ¶”κ°€ μƒ¤λ“λ΅ ν΄λ¬μ¤ν„°μ μ €μ¥ μ©λ‰μ„ λλ¦΄ μ μμµλ‹λ‹¤.

**κ³ κ°€μ©μ„±**
- config μ„λ²„ λ° μƒ¤λ“λ¥Ό λ³µμ λ³Έ μ„ΈνΈλ΅ λ°°ν¬ν•λ©΄ κ°€μ©μ„±μ΄ ν–¥μƒλ©λ‹λ‹¤.

<br/>

## Sharding Strategy

> MongoDBλ” μƒ¤λ”©λ ν΄λ¬μ¤ν„° μ „λ°μ— λ°μ΄ν„°λ¥Ό λ¶„μ‚°ν•κΈ° μ„ν• λ‘ κ°€μ§€ μƒ¤λ”© μ „λµμ„ μ§€μ›

**Hashed Sharding**
- μƒ¤λ“ ν‚¤ ν•„λ“ κ°’μ ν•΄μ‹λ¥Ό κ³„μ‚°ν•λ” μ‘μ—…μ΄ ν¬ν•¨(ν•΄μ‹λ¥Ό μλ™μΌλ΅ κ³„μ‚°)
  - κ·Έλ° λ‹¤μ κ° μ²­ν¬μ—λ” ν•΄μ‹ μƒ¤λ“ ν‚¤ κ°’μ— λ”°λΌ λ²”μ„κ°€ ν• λ‹Ή
- ν•΄μ‹ κ°’μ΄ κ°™μ€ μ²­ν¬μ— μμ„ κ°€λ¥μ„±μ΄ λ‚®μ
- ν•΄μ‹λ κ°’μ„ κΈ°λ°μΌλ΅ ν•λ” λ°μ΄ν„° λ¶„μ‚°μ€ νΉν μƒ¤λ“ ν‚¤κ°€ λ‹¨μ΅°λ΅­κ² λ³€κ²½λλ” λ°μ΄ν„° μ„ΈνΈμ—μ„ λ”μ± κ· μΌν• λ°μ΄ν„° λ¶„μ‚° κ°€λ¥

<center><img src="https://www.mongodb.com/ko-kr/docs/manual/images/sharding-hash-based.bakedsvg.svg" width="100%"></center>

**Ranged Sharding**
- μƒ¤λ“ ν‚¤ κ°’μ„ κΈ°μ¤€μΌλ΅ λ°μ΄ν„°λ¥Ό λ²”μ„λ΅ λ‚λ„λ” μ‘μ—…μ΄ ν¬ν•¨
  - μƒ¤λ“ ν‚¤ κ°’μ„ κΈ°λ°μΌλ΅ κ° μ²­ν¬μ— λ²”μ„κ°€ ν• λ‹Ή
- μƒ¤λ“ ν‚¤λ” λ™μΌν• μ²­ν¬μ— μ΅΄μ¬ν•  κ°€λ¥μ„±μ΄ λ†’μ

<center><img src="https://www.mongodb.com/ko-kr/docs/manual/images/sharding-range-based.bakedsvg.svg" width="100%"></center>

π‘‰π» λ²”μ„κ°€ μ§€μ •λ μƒ¤λ”©μ ν¨μ¨μ„±μ€ μ„ νƒν• μƒ¤λ“ ν‚¤μ— λ”°λΌ λ‹¬λΌμ§‘λ‹λ‹¤. 
- μƒ¤λ“ ν‚¤λ¥Ό μ λ€λ΅ κ³ λ ¤ν•μ§€ μ•μΌλ©΄ λ°μ΄ν„°κ°€ κ³ λ¥΄μ§€ μ•κ² λ¶„μ‚°λμ–΄ μƒ¤λ”©μ μΌλ¶€ μ΄μ μ„ λ¬΄ν¨ν™”ν•κ±°λ‚ μ„±λ¥ λ³‘λ© ν„μƒμ„ μ΄λν•  μ μμµλ‹λ‹¤.
