# π“Β λ™μ‹μ„± μ μ–΄ λ°©μ‹ λΉ„κµ

**Series**
> [Java Concurrency Control](https://data-make.tistory.com/790)
>
> [Database Concurrency Control](https://data-make.tistory.com/791)
>
> [Redis Concurrency Control](https://data-make.tistory.com/792)
>
> [Kafka Concurrency Control](https://data-make.tistory.com/793)
>
> [Compare Concurrency Control](https://data-make.tistory.com/794)

β οΈΒ 
> λ΅μ»¬μ—μ„ ν…μ¤νΈν• κ²°κ³Όμ΄κ³ ,
> 
> μ„λ²„ ν™κ²½κ³Ό μ—¬λ¬ μ”μΈλ“¤μ— μν•΄ κ²°κ³Όκ°€ λ‹¬λΌμ§ μ μκ³ , μ •ν™•ν•μ§€ μ•μ„ μ μμµλ‹λ‹¤.

## Case 01

**ν•μ •μλ‰ : `50,000`**

- Total User : `296`
- Processes : `8`
- Threads : `37`

(DB Named λ°©μ‹μ€ μ μ™Έ)

|                     | Java Async | Java Sync | DB Pessimistic | DB Optimistic   | DB Named                    | Redis Incr     | Redis Lettuce   | Redis Redisson  | Kafka + Redis  |
| ------------------- | ---------- | --------- | -------------- | --------------- | --------------------------- | -------------- | --------------- | --------------- | -------------- |
| ν•μ •μλ‰            | 50,000     | 50,000    | 50,000         | 50,000          | 10,000                      | 50,000         | 50,000          | 50,000          | 50,000         |
| Total User          | 296        | 296       | 296            | 296             | 40                          | 296            | 296             | 296             | 296            |
| Processes / Threads             | 8 / 37     | 8 / 37    | 8 / 37         | 8 / 37          | 2 / 20                      | 8 / 37         | 8 / 37          | 8 / 37          | 8 / 37         |
| Duration            | 3 min.     | 3 min.    | 3 min.         | 3 min.          | 3 min. (01:57)              | 3 min. (01:40) | 3 min.          | 3 min.          | 3 min. (01:50) |
| TPS                 | 975.5      | 567.0     | 283.6          | 218.3           | 87.5                        | 519.3          | 177.9           | 163.2           | 470.6          |
| Peak TPS            | 1,164      | 667       | 444            | 248             | 181                         | 2,082          | 218             | 190             | 1,534          |
| Mean Test Time (ms) | 301.43     | 488.02    | 750.04         | 1,350.66        | 244.13                      | 189.74         | 1,643.21        | 1,802.55        | 252.14         |
| Executed Tests      | 171,933    | 112,696   | 79,791         | 38,491          | 22,668                      | 82,720         | 31,380          | 28,816          | 82,697         |
| Successful Tests    | 171,933    | 99,971    | 50,000         | 38,491          | 10,000                      | 50,000         | 31,380          | 28,816          | 50,000         |
| Errors              | 0          | 12,725    | 29,791         | 0               | 12,668                      | 32,720         | 0               | 0               | 32,697         |
| Concurrency Control | Fail       | Fail      | Success        | Low performance | Dead Lock + Low performance | Success        | Low performance | Low performance | Success        |

<br/>.<br/>

μ‹κ°„ λ‚΄μ— λ¨λ“  νΈλν”½μ„ μ„±κ³µμ μΌλ΅ μ²λ¦¬ν• λ°©μ‹

- **DB Pessimistic**
- **Redis Incr**
- **Kafka + Redis**

<br/>.<br/>

μΌλ¶€ μ„±κ³µμ„ ν•κΈ΄ ν•μ€μ§€λ§, νΈλν”½μ„ λ²„ν‹°μ§€ λ»ν•κ³  μ„±λ¥ λ¬Έμ κ°€ λ°μƒν• λ°©μ‹ (μ„±λ¥ λ¬Έμ κ°€ λ°μƒν• κ°μΈμ μΈ μƒκ°λ„ λ‹΄μ•„λ³΄μ•λ‹¤.)

- **DB Optimistic β†’** μ¶©λ μ²λ¦¬ λΉ„μ© *(μ¶©λ μ‹ ν•΄λ‹Ή νΈλμ­μ… μ¬μ‹λ„)* μΌλ΅ μΈν• μ„±λ¥ μ €ν•
- **DB Named β†’** μ»¤λ„¥μ… ν’€ λ¶€μ΅±μΌλ΅ μΈν• DeadLock λ°μƒ λ° μ„±λ¥ μ €ν•
- **Redis Lettuce β†’ Spin Lock λ°©μ‹** *(λ°λ³µμ μΌλ΅ ν™•μΈν•λ©΄μ„ λ½ νλ“μ„ μ‹λ„)* **μΌλ΅ μΈν• CPU λ¶€ν•**
- **Redis Redisson β†’ λ‚΄λ¶€μ μΌλ΅ κµ¬ν„λ μ¬μ‹λ„ λ΅μ§** *(νΉμ • κ°„κ²©μΌλ΅ μ¬μ‹λ„)* **μ—μ„ λ°μƒν•λ” λ¶€ν•**

<br/>.<br/>

λ΅μ»¬ PCμ—μ„ λ²„ν‹Έ μ μλ” νΈλν”½μ΄ μ•„λ‹λΌμ„ κ²°κ³Όκ°€ ν„μ‹¤κ³Όλ” λ‹¤λ¥Ό μλ„ μμ§€λ§,

μ²μ κ²°κ³Όλ¥Ό λ³΄μ•μ„ λ• λΉ λ¥Έ μ„±λ¥μ„ μλ‘ν•λ” **Redis μ Lettuce, Redisson** λ°©μ‹μ΄ μ„±λ¥ μ €ν• μ΄μκ°€ μμ„ μ¤„μ„ λ°λλ‹¤.

λ½ νλ“μ„ μ„ν• μ¬μ‹λ„ λ΅μ§μΌλ΅ μΈν•΄μ„ λ°μƒν•λ” μ„±λ¥ μ €ν•μΌ μλ„ μμ„ κ²ƒμ΄λΌλ” μƒκ°μ΄ λ“ λ‹¤.
