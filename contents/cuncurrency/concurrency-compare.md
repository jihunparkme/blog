# π“Β λ™μ‹μ„± μ μ–΄ λ°©μ‹ λΉ„κµ

**Series**
> [Java Concurrency Control](https://data-make.tistory.com/790)
>
> [Database Concurrency Control](https://data-make.tistory.com/791)
>
> [Redis Concurrency Control](https://data-make.tistory.com/792)
>
> [Kafka Concurrency Control](https://data-make.tistory.com/793)
>
> [Compare Concurrency Control](https://data-make.tistory.com/794)

β οΈΒ 
> λ΅μ»¬μ—μ„ ν…μ¤νΈν• κ²°κ³Όμ΄κ³ ,
> 
> μ„λ²„ ν™κ²½κ³Ό μ—¬λ¬ μ”μΈλ“¤μ— μν•΄ κ²°κ³Όκ°€ λ‹¬λΌμ§ μ μκ³ , μ •ν™•ν•μ§€ μ•μ„ μ μμµλ‹λ‹¤.

## Case 01

**ν•μ •μλ‰ : `50,000`**

- Total User : `296`
- Processes : `8`
- Threads : `37`

(DB Named λ°©μ‹μ€ μ μ™Έ)

![Result](https://github.com/jihunparkme/blog/blob/0f52180eb07cdddf77a1c351ad06600ae7d5cad7/img/concurrency/compare-1.png?raw=true 'Result')

<br/>.<br/>

μ‹κ°„ λ‚΄μ— λ¨λ“  νΈλν”½μ„ μ„±κ³µμ μΌλ΅ μ²λ¦¬ν• λ°©μ‹

- **DB Pessimistic**
- **Redis Incr**
- **Kafka + Redis**

<br/>.<br/>

μΌλ¶€ μ„±κ³µμ„ ν•κΈ΄ ν•μ€μ§€λ§, νΈλν”½μ„ λ²„ν‹°μ§€ λ»ν•κ³  μ„±λ¥ λ¬Έμ κ°€ λ°μƒν• λ°©μ‹ (μ„±λ¥ λ¬Έμ κ°€ λ°μƒν• κ°μΈμ μΈ μƒκ°λ„ λ‹΄μ•„λ³΄μ•λ‹¤.)

- **DB Optimistic β†’** μ¶©λ μ²λ¦¬ λΉ„μ© *(μ¶©λ μ‹ ν•΄λ‹Ή νΈλμ­μ… μ¬μ‹λ„)* μΌλ΅ μΈν• μ„±λ¥ μ €ν•
- **DB Named β†’** μ»¤λ„¥μ… ν’€ λ¶€μ΅±μΌλ΅ μΈν• DeadLock λ°μƒ λ° μ„±λ¥ μ €ν•
- **Redis Lettuce β†’ Spin Lock λ°©μ‹** *(λ°λ³µμ μΌλ΅ ν™•μΈν•λ©΄μ„ λ½ νλ“μ„ μ‹λ„)* **μΌλ΅ μΈν• CPU λ¶€ν•**
- **Redis Redisson β†’ λ‚΄λ¶€μ μΌλ΅ κµ¬ν„λ μ¬μ‹λ„ λ΅μ§** *(νΉμ • κ°„κ²©μΌλ΅ μ¬μ‹λ„)* **μ—μ„ λ°μƒν•λ” λ¶€ν•**

<br/>.<br/>

λ΅μ»¬ PCμ—μ„ λ²„ν‹Έ μ μλ” νΈλν”½μ΄ μ•„λ‹λΌμ„ κ²°κ³Όκ°€ ν„μ‹¤κ³Όλ” λ‹¤λ¥Ό μλ„ μμ§€λ§,

μ²μ κ²°κ³Όλ¥Ό λ³΄μ•μ„ λ• λΉ λ¥Έ μ„±λ¥μ„ μλ‘ν•λ” **Redis μ Lettuce, Redisson** λ°©μ‹μ΄ μ„±λ¥ μ €ν• μ΄μκ°€ μμ„ μ¤„μ„ λ°λλ‹¤.

λ½ νλ“μ„ μ„ν• μ¬μ‹λ„ λ΅μ§μΌλ΅ μΈν•΄μ„ λ°μƒν•λ” μ„±λ¥ μ €ν•μΌ μλ„ μμ„ κ²ƒμ΄λΌλ” μƒκ°μ΄ λ“ λ‹¤.

## Case 02

**ν•μ •μλ‰ : `1,000`**

- Total User : `99`
- Processes : `3`
- Threads : `33`

![Result](https://github.com/jihunparkme/blog/blob/0f52180eb07cdddf77a1c351ad06600ae7d5cad7/img/concurrency/compare-2.png?raw=true 'Result')

<br/>.<br/>

μ‹κ°„ λ‚΄μ— λ¨λ“  νΈλν”½μ„ μ„±κ³µμ μΌλ΅ μ²λ¦¬ν• λ°©μ‹

- **DB Pessimistic**
- **DB Optimistic**
- **Redis Incr**
- **Redis Lettuce**
- **Redis Redisson**
- **Kafka + Redis**

<br/>.<br/>

μΌλ¶€ μ„±κ³µμ„ ν•κΈ΄ ν•μ€μ§€λ§, νΈλν”½μ„ λ²„ν‹°μ§€ λ»ν•κ³  μ„±λ¥ λ¬Έμ κ°€ λ°μƒν• λ°©μ‹

- **DB Named β†’** μ»¤λ„¥μ… ν’€ λ¶€μ΅±μΌλ΅ μΈν• DeadLock λ°μƒ λ° μ„±λ¥ μ €ν•

<br/>.<br/>

ν•μ •μλ‰μ΄ 50,000 κ±΄μΌ κ²½μ°μ— λΉ„ν•΄ λ€λ¶€λ¶„μ λ°©μ‹μ΄ μ„±κ³µμ μΌλ΅ λ¨λ“  νΈλν”½μ„ μ²λ¦¬ν• κ²ƒμ„ λ³Ό μ μλ‹¤.

μ„ κ²°κ³Όλ“¤μ„ ν†µν•΄ μ§€κ·Ήν κ°μΈμ μΈ μƒκ°μΌλ΅ κ° λ°©μ‹μ— λ€ν• κ²°λ΅ μ„ λ‚΄λ³΄λ ¤κ³  ν•λ‹¤.

## Compare

### **Java**

- **Java Async**
    - **λ™μ‹μ„± μ΄μ μ‚¬λ΅€μ ν‘λ³Έ**
- **Java Sync**
    - μ„λ²„κ°€ 2λ€ μ΄μƒμΌ κ²½μ° **λ™μ‹μ„± μ΄μ λ°μƒ**

> μ‹¤λ¬΄μ—μ„ λ™μ‹μ„± μ²λ¦¬μ— `μ λ€ μ‚¬μ©ν•  μ μ—†λ”` λ°©μ‹.

### **Database**

- **Databse Pessimistic Lock**
    - μ¶©λμ΄ λΉλ²ν•κ² λ°μƒν•  μ μλ” μƒν™©μ΄κ±°λ‚
    - λ°μ΄ν„°λ² μ΄μ¤μ— λ¶€ν•κ°€ μ¬ μ •λ„μ λ™μ‹ νΈλν”½μ„ κ²¬λμ•Ό ν•λ” μƒν™©μ΄ μ•„λ‹λΌλ©΄ μ ν•©ν•λ‹¤κ³  μƒκ°
- **Databse Optimistic Lock**
    - μ λ‹Ήν• νΈλν”½μ—μ„λ” μ‚¬μ©ν• λ§ ν•μ§€λ§,
    - Ramp-Up ν…μ¤νΈλ¥Ό ν†µν•΄ μ–Όλ§νΌ λ²„ν‹Έ μ μμ„μ§€ κ²€μ¦μ΄ ν•„μ”
- **Databse Named Lock**
    - μ»¤λ„¥μ… ν’€ λ¶€μ΅± ν„μƒμΌλ΅ μ‹¤λ¬΄μ—μ„ μ μ©μ€ μ–΄λ ¤μ› λ³΄μ„

> κ°μΈμ μΌλ΅ λ°μ΄ν„°λ² μ΄μ¤μ— λ½μ„ μ μ©ν•λ” λ°©μ‹μ€ 
> 
> κ°™μ€ λ°μ΄ν„°λ² μ΄μ¤λ¥Ό μ‚¬μ©ν•λ” λ‹¤λ¥Έ μ„λΉ„μ¤μ— μ„±λ¥ μ΄μλ¥Ό μ „νν•  μ μλ‹¤κ³  μƒκ°ν•΄μ„
> 
> `λ€λ‰μ νΈλν”½`μ„ κ²¬λμ•Ό ν•λ” μƒν™©μ΄λΌλ©΄ `Redis`, `Kafka` λ¥Ό ν™μ©ν•κ³ 
> 
> `μ†λ‰μ νΈλν”½`λ§ κ²¬λλ„ λλ” μƒν™©μ΄λΌλ©΄ `Pessimistic Lock` μ„ μ μ©ν•λ”κ² μ μ ν•λ‹¤κ³  μƒκ°

### Redis

- **Redis Incr**
    - κ°€μ¥ μΆ‹μ€ μ„±λ¥μ„ λ³΄μ 
    - λ©”λ¨λ¦¬ κΈ°λ°μ΄κ³  μ„λ²„κ°€ μ¬μ‹μ‘λκ±°λ‚ μ¥μ•  λ°μƒ μ‹ λ°μ΄ν„° μ μ‹¤ κ°€λ¥μ„±μ΄ μ΅΄μ¬ν•λ” λ‹¨μ 
- **Redis Lettuce / Redisson**
    - μ¬μ‹λ„ λ΅μ§μΌλ΅ μΈν• λ¶€ν•λ΅ λ€λ‰μ νΈλν”½μ—μ„ μΆ‹μ€ μ„±λ¥μ„ λ‚Ό μλ” μ—†μ„ κ²ƒ κ°™μ
    - λ¶„μ‚°λ½μ ν•κ³„λ„ μ΅΄μ¬ β†’ [λ λ””μ¤κ°€ μ κ³µν•λ” λ¶„μ‚°λ½(RedLock)μ νΉμ§•κ³Ό ν•κ³„](https://mangkyu.tistory.com/311)
    - Ramp-Up ν…μ¤νΈλ¥Ό ν†µν•΄ μ–Όλ§νΌμ νΈλν”½μ—μ„ μ„±λ¥μ„ λ‚Ό μ μμ„μ§€ κ²€μ¦μ΄ ν•„μ”

> `Redis Incr` λ°©μ‹μ€ λ°μ΄ν„°κ°€ μ μ‹¤λλ” μƒν™©μ— λ€ν• λ€λΉ„λ§ μ λμ–΄μλ‹¤λ©΄ κ°€μ¥ μΆ‹μ€ λ°©μ‹μ΄λΌκ³  μƒκ° 

### Kafka

- **Kafka + Redis**
    - μ„κ³„κ°’ μ μ–΄μ™€ λΉ„μ¦λ‹μ¤ λ΅μ§ μ²λ¦¬μ μ—­ν• μ„ λ¶„λ¦¬
    - λ¶€ν•κ°€ λ¶„μ‚°λλ―€λ΅ λ€λ‰μ νΈλν”½μ— μ ν•©ν• λ°©μ‹μ΄λΌκ³  μƒκ°

> `Redis Inc` λ°©μ‹μ„ ν™μ©ν•μ§€λ§, λ€λ¶€λ¶„μ λΉ„μ¦λ‹μ¤ λ΅μ§μ€ μ²λ¦¬ μ‹κ°„μ΄ λ‹¤μ† μ†μ”λλ‹¤ λ³΄λ‹
> 
> μ„κ³„κ°’ μ μ–΄λ” Redisμ—μ„ μ²λ¦¬ν•κ³ , λΉ„μ¦λ‹μ¤ λ΅μ§μ€ Kafka Consumerκ°€ μ²λ¦¬ν•λ©΄μ„
> 
> λ¶€ν•λ¥Ό λ¶„μ‚°μ‹μΌ μ„±λ¥μ„ ν–¥μƒμ‹ν‚¬ μ μλ” κ°€μ¥ μΆ‹μ€ λ°©λ²•μ΄λΌκ³  μƒκ°

# Reference.

- [Concurrency issues](https://jihunparkme.gitbook.io/docs/lecture/study/concurrency-issues)
- [First Come First Served](https://jihunparkme.gitbook.io/docs/lecture/study/first-come-first-served-event)
- [Performance Test](https://jihunparkme.gitbook.io/docs/lecture/study/performance-test)